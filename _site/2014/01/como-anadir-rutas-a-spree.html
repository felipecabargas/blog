<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

  <title>[HOW-TO] Añadir y testear rutas en un engine de rails cómo Spree</title>
  <meta name="description" content="Cómo siempre, para añadir nuevas rutas, se deben añadir con los correspondientes métodos al config/routes.rb. En el caso de Spree estas rutas no deben dibuja...">

  
  <link rel="icon" href="/images/ndd-logo.png" />
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2014/01/como-anadir-rutas-a-spree">
  <link rel="alternate" type="application/rss+xml" title="Felipe Cabargas&#39;s NDD" href="/feed.xml">
  
  
</head>

  <body>
    <div class="container">
      <div class="post">
        <div class="bio__header">
          <a href="http://localhost:4000/">
            Felipe Cabargas's NDD
          </a>
        </div>

        <div class="post__meta">
          <div class="post__title">[HOW-TO] Añadir y testear rutas en un engine de rails cómo Spree</div>
          <div class="post__date">
            
              01/29/2014
            
          </div>
          <div class="post__cat">Tutorial</div>
        </div>

        <div class="post__body">
          <p>Cómo siempre, para añadir nuevas rutas, se deben añadir con los correspondientes métodos al <code class="highlighter-rouge">config/routes.rb</code>. En el caso de <strong>Spree</strong> estas rutas no deben dibujarse en <code class="highlighter-rouge">Rails.application.routes</code> si no que en <code class="highlighter-rouge">Spree::Core:Engine.routes</code>; así, para añadir un modelo CRUD al panel de administrador de la plataforma:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Spree</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:items</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Al añadir rutas, se crearán paths dentro del namespace señalado de esta forma:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>spree  / Spree::Core::Engine

Routes <span class="k">for </span>Spree::Core::Engine:
                                      admin_items GET    /admin/items<span class="o">(</span>.:format<span class="o">)</span>                                                      spree/admin/items#index
                                                  POST   /admin/items<span class="o">(</span>.:format<span class="o">)</span>                                                      spree/admin/items#create
                                   new_admin_item GET    /admin/items/new<span class="o">(</span>.:format<span class="o">)</span>                                                  spree/admin/items#new
                                  edit_admin_item GET    /admin/items/:id/edit<span class="o">(</span>.:format<span class="o">)</span>                                             spree/admin/items#edit
                                       admin_item GET    /admin/items/:id<span class="o">(</span>.:format<span class="o">)</span>                                                  spree/admin/items#show
                                                  PATCH  /admin/items/:id<span class="o">(</span>.:format<span class="o">)</span>                                                  spree/admin/items#update
                                                  PUT    /admin/items/:id<span class="o">(</span>.:format<span class="o">)</span>                                                  spree/admin/items#update
                                                  DELETE /admin/items/:id<span class="o">(</span>.:format<span class="o">)</span>                                                  spree/admin/items#destroy

</code></pre>
</div>

<p>A pesar de esto, al intentar testear cualquier elemento que contenga rutas con RSpec, los test arrojarán <code class="highlighter-rouge">undefined method some_new_path</code> - <a href="https://gist.github.com/felipecabargas/8676836">véase ejemplo aquí</a> -.</p>

<p>Esto se debe a que estas rutas están <strong>dibujadas</strong> dentro de <strong>Spree</strong> y no dentro de Application::Routes por lo cual deben ser llamadas usando el prefijo <strong>spree.</strong>, por ejemplo en una vista:</p>

<div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Show'</span><span class="p">,</span> <span class="n">spree</span><span class="p">.</span><span class="nf">admin_items_path</span><span class="p">(</span><span class="vi">@item</span><span class="p">),</span> <span class="ss">class: </span><span class="s2">"button"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">spree</span><span class="p">.</span><span class="nf">admin_items_path</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"button"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>

<p>y en un controlador:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="vi">@item</span><span class="p">.</span><span class="nf">save</span>
  <span class="n">redirect_to</span> <span class="n">spree</span><span class="p">.</span><span class="nf">admin_items_url</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Item was successfully updated.'</span>
<span class="k">else</span>
  <span class="n">render</span> <span class="ss">action: </span><span class="s1">'new'</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Para los test de routing, también encontramos el mismo problema, que puede ser fácilmente sorteado al añadir esta línea tras el <code class="highlighter-rouge">describe "routing" do</code>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">routes</span> <span class="p">{</span> <span class="no">Spree</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span> <span class="p">}</span>
</code></pre>
</div>

        </div>

        
          <div class="post__paginate">
            
              <a class="post__paginate-left" href="http://localhost:4000/2013/12/how-to-installing-kitkat-44-in-the-moto-x-xt1058-with-locked-bootloader">[HOW-TO] Install Android KitKat (4.4) on the Moto X (XT1058) with locked bootloader</a>
            

            
              <a class="post__paginate-right" href="http://localhost:4000/2014/02/my-frist-month-with-tdd">My 1st month with TDD or "Why TDD is a pain in the ass but you should learn and use it anyway"</a>
            
          </div>
        
      </div>

      
  <ul class="rows">
    <li class="row__cols">
      <div class="row__title">
        
          Title
        
      </div>
      <div class="row__date">
        
          Date
        
      </div>
      <div class="row__cat">
        
          Category
        
      </div>
    </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2017/06/tip-of-the-day-not-null-columns-ror">
          <div class="row__title ">
            [Daily Tip] How to force existing column to contain data in Rails
          </div>
          <div class="row__date ">
            
              06/08/2017
            
          </div>
          <div class="row__cat ">
            Tips
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2017/06/tip-of-the-day-devise-to-accept-extra-fields">
          <div class="row__title ">
            [Daily Tip] How to add extra fields during user registration with Devise
          </div>
          <div class="row__date ">
            
              06/07/2017
            
          </div>
          <div class="row__cat ">
            Tips
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2016/02/comunidades">
          <div class="row__title ">
            Comunidades, una actualización necesaria.
          </div>
          <div class="row__date ">
            
              02/22/2016
            
          </div>
          <div class="row__cat ">
            UX
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2015/10/comunidad-sin-lugares-comunes">
          <div class="row__title ">
            Comunidad sin lugares comunes, Parte 1
          </div>
          <div class="row__date ">
            
              10/05/2015
            
          </div>
          <div class="row__cat ">
            UX
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2014/12/a-little-explanation-on-spring">
          <div class="row__title ">
            A little explanation on Spring
          </div>
          <div class="row__date ">
            
              12/01/2014
            
          </div>
          <div class="row__cat ">
            RailsRuby
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2014/09/speed-up-your-workflow-with-teamocil-and-tmux">
          <div class="row__title ">
            Teamocil: speeding up your Tmux workflow 
          </div>
          <div class="row__date ">
            
              09/16/2014
            
          </div>
          <div class="row__cat ">
            Design
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2014/03/mac-sketches">
          <div class="row__title ">
            Mac Sketches for everyone (!)
          </div>
          <div class="row__date ">
            
              03/02/2014
            
          </div>
          <div class="row__cat ">
            Design
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2014/02/my-frist-month-with-tdd">
          <div class="row__title ">
            My 1st month with TDD or "Why TDD is a pain in the ass but you should learn and use it anyway"
          </div>
          <div class="row__date ">
            
              02/17/2014
            
          </div>
          <div class="row__cat ">
            Developer Life
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2014/01/como-anadir-rutas-a-spree">
          <div class="row__title row__active">
            [HOW-TO] Añadir y testear rutas en un engine de rails cómo Spree
          </div>
          <div class="row__date row__active">
            
              01/29/2014
            
          </div>
          <div class="row__cat row__active">
            Tutorial
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/12/how-to-installing-kitkat-44-in-the-moto-x-xt1058-with-locked-bootloader">
          <div class="row__title ">
            [HOW-TO] Install Android KitKat (4.4) on the Moto X (XT1058) with locked bootloader
          </div>
          <div class="row__date ">
            
              12/18/2013
            
          </div>
          <div class="row__cat ">
            Tutorial
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/08/rails-creating-a-gem-from-scratch-day-1">
          <div class="row__title ">
            [RUBY] Creating a Gem from scratch - Day 1
          </div>
          <div class="row__date ">
            
              08/03/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/07/rails-rename-paths-and-routes-instead-of-renaming-model">
          <div class="row__title ">
            [RAILS] Rename paths & routes in a resource
          </div>
          <div class="row__date ">
            
              07/16/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/06/pensamientos-tras-otro-angelhack">
          <div class="row__title ">
            [LIFE] Pensamientos tras otro AngelHack SCL
          </div>
          <div class="row__date ">
            
              06/05/2013
            
          </div>
          <div class="row__cat ">
            Squape
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/06/flat-ui-y-el-futuro-del-diseno">
          <div class="row__title ">
            [DESIGN] Flat UI y el futuro del diseño digital
          </div>
          <div class="row__date ">
            
              06/05/2013
            
          </div>
          <div class="row__cat ">
            Design
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/05/verifying-local-data-on-transmission">
          <div class="row__title ">
            [OS X] Verify Local Data on Transmission for Mac
          </div>
          <div class="row__date ">
            
              05/18/2013
            
          </div>
          <div class="row__cat ">
            HowTo
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/05/install-python-274-and-pygame-without-homebrew">
          <div class="row__title ">
            [OS X] Install Python 2.7.4 & PyGame in Mountain Lion without Homebrew
          </div>
          <div class="row__date ">
            
              05/15/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/05/install-pygame-mac-with-homebrew-python">
          <div class="row__title ">
            [OS X] Install pygame on OS X with a Homebrew Python 2.7 install
          </div>
          <div class="row__date ">
            
              05/14/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/04/search-for-element-not-in-a-list">
          <div class="row__title ">
            [PYTHON] Check existence of an element inside a list
          </div>
          <div class="row__date ">
            
              04/16/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/03/presenting-labs">
          <div class="row__title ">
            Presenting LABS
          </div>
          <div class="row__date ">
            
              03/30/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/03/introducing-aseo">
          <div class="row__title ">
            Introducing ASEO
          </div>
          <div class="row__date ">
            
              03/22/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/03/no-todo-el-buen-diseno-es-oro">
          <div class="row__title ">
            No todo el buen diseño es oro
          </div>
          <div class="row__date ">
            
              03/21/2013
            
          </div>
          <div class="row__cat ">
            Design
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/02/tip-mysql-file-inyection-via-terminal">
          <div class="row__title ">
            [TIP] Importar archivos *.sql desde la terminal
          </div>
          <div class="row__date ">
            
              02/10/2013
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/02/edoome-trabajar-en-un-startup">
          <div class="row__title ">
            [EDOOME] Trabajar en un Startup
          </div>
          <div class="row__date ">
            
              02/08/2013
            
          </div>
          <div class="row__cat ">
            Proyectos
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2013/01/project-creando-un-podcast">
          <div class="row__title ">
            [PROYECTOS] Empezando un Podcast de tecnología
          </div>
          <div class="row__date ">
            
              01/20/2013
            
          </div>
          <div class="row__cat ">
            Proyectos
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/12/review-ipad-mini">
          <div class="row__title ">
            [REVIEW] iPad Mini
          </div>
          <div class="row__date ">
            
              12/29/2012
            
          </div>
          <div class="row__cat ">
            Review
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/11/rails-rename-a-rails-app">
          <div class="row__title ">
            [HACKING] Renaming a Rails app
          </div>
          <div class="row__date ">
            
              11/26/2012
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/11/preparando-angel-hack">
          <div class="row__title ">
            [HACKING] Preparando Angel Hack
          </div>
          <div class="row__date ">
            
              11/22/2012
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/09/fedora-18-fix-libudev0-requirement-for-google-chrome">
          <div class="row__title ">
            [Fedora 18] Fix "libudev.so.0" requirement for Google Chrome / Chromium
          </div>
          <div class="row__date ">
            
              09/21/2012
            
          </div>
          <div class="row__cat ">
            Linux
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/09/fedora-update-via-yum-from-stable-to-rawhide">
          <div class="row__title ">
            [Fedora] Update from Stable to Rawhide via Yum
          </div>
          <div class="row__date ">
            
              09/19/2012
            
          </div>
          <div class="row__cat ">
            Linux
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/08/y-nos-fuimos-a-jekyll">
          <div class="row__title ">
            Y nos fuimos a Jekyll
          </div>
          <div class="row__date ">
            
              08/27/2012
            
          </div>
          <div class="row__cat ">
            Jekyll
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/07/tip-android-take-screenshots-with-the-android-sdk">
          <div class="row__title ">
            [TIP] Android: Take screenshots with the Android SDK
          </div>
          <div class="row__date ">
            
              07/22/2012
            
          </div>
          <div class="row__cat ">
            Linux
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/07/ios-set-an-icon-for-safari-mobile-web-apps">
          <div class="row__title ">
            [TIP] iOS: Set an icon for Safari Mobile Web Apps
          </div>
          <div class="row__date ">
            
              07/16/2012
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/07/set-up-a-service-to-start-on-boot">
          <div class="row__title ">
            [TIP] LINUX: Set-up a service to start on boot
          </div>
          <div class="row__date ">
            
              07/15/2012
            
          </div>
          <div class="row__cat ">
            Linux
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/07/heroku-configuracion-de-dns-desde-cpanel">
          <div class="row__title ">
            [HEROKU] Configuración de DNS desde CPANEL
          </div>
          <div class="row__date ">
            
              07/08/2012
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/07/hacking-mockingbird-dev">
          <div class="row__title ">
            [HACKING] Mockingbird Dev
          </div>
          <div class="row__date ">
            
              07/03/2012
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/07/ensayo-explotacion-laboral-en-china-y-el-compromiso-de-occidente">
          <div class="row__title ">
            [ENSAYO] Explotación laboral en China y el compromiso de Occidente 
          </div>
          <div class="row__date ">
            
              07/01/2012
            
          </div>
          <div class="row__cat ">
            Off-Topic
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/06/skype-4-0-for-linux-algo-huele-mal-y-no-es-microsoft">
          <div class="row__title ">
            Skype 4.0 for Linux - Algo huele mal (y no es Microsoft)
          </div>
          <div class="row__date ">
            
              06/16/2012
            
          </div>
          <div class="row__cat ">
            Linux
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/06/ruby-on-rails-iniciar-una-nueva-app-comandos-utiles">
          <div class="row__title ">
            Ruby on Rails: Iniciar una nueva app - Comandos útiles
          </div>
          <div class="row__date ">
            
              06/16/2012
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/05/tip-set-a-dev-domain-for-your-project">
          <div class="row__title ">
            [TIP] Set a “.dev” domain for your project
          </div>
          <div class="row__date ">
            
              05/06/2012
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2012/04/fedora-17-set-ruby-on-rails-and-make-it-work">
          <div class="row__title ">
            [Fedora 17] Set Ruby on Rails and make it work
          </div>
          <div class="row__date ">
            
              04/01/2012
            
          </div>
          <div class="row__cat ">
            Linux
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2011/11/centaurus-python-gtk-webkit-simple-web-browser">
          <div class="row__title ">
            Centaurus: Python, GTK+ & WebKit Simple Web Browser
          </div>
          <div class="row__date ">
            
              11/12/2011
            
          </div>
          <div class="row__cat ">
            Hacking
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2011/10/adwaita-dark-para-gnome-3">
          <div class="row__title ">
            Adwaita Dark para Gnome 3
          </div>
          <div class="row__date ">
            
              10/19/2011
            
          </div>
          <div class="row__cat ">
            Design
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2011/10/reemplazando-actividades-por-el-icono-de-tu-distro">
          <div class="row__title ">
            Reemplazando "Actividades" por el ícono de tu distro
          </div>
          <div class="row__date ">
            
              10/12/2011
            
          </div>
          <div class="row__cat ">
            Linux
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2011/10/a-partir-de-hoy-tambien-en-patatux-net">
          <div class="row__title ">
            A partir de hoy también en Patatux.net
          </div>
          <div class="row__date ">
            
              10/11/2011
            
          </div>
          <div class="row__cat ">
            Off-Topic
          </div>
        </a>

        
      </li>
    
      <li class="row__post">
        <a href="http://localhost:4000/2011/10/un-mes-al-aire">
          <div class="row__title ">
            Un mes al aire
          </div>
          <div class="row__date ">
            
              10/10/2011
            
          </div>
          <div class="row__cat ">
            Off-Topic
          </div>
        </a>

        
      </li>
    
  </ul>

    </div>
  </body>

</html>